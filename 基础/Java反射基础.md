# 反射

## 1.简介

> **反射：**在大部分面向对象语言中都存在的一种特性。
>
> 对于Java来说相当于将静态语言附上了动态的特性。

## 2.作用

我们通过**反射**可以获取一个正在执行中的类。实例化这个类并且调用类中的方法（**私有的方法也可以**）。

## 3.反射的原理

> 通过上面的两点的描述可以清楚的是：**我们需要通过类获取一个Class对象。**
>
> 所以我们需要深入理解一下，反射为什么能够获取到一个类？

### 3.1 Class对象

> `RTTI` (Run-Time Type Identification)**运行时类型识别**: 识别一个对象的类型和类的信息。
>
> - 定义方法、变量、类的时候就需要确定类型，所有编译时所有的类型都已经是确定的。
> - 通过反射 可以在运行中使用其它的类.

![img](https://xzfile.aliyuncs.com/media/upload/picture/20210122163639-f253b862-5c8c-1.png)

#### 3.1.1 Class对象的创建

  创建一个类的时候,我们需要定义类的所有信息(方法|类型|变量),编译这个Java文件的时候,会将源码翻译成二进制的字节码,同时将这些字节码保存在`.class`文件中.

`class`作用:

- 记录类文件中的属性 | 方法 | 常量
- 自动添加一个对象`Class` **保存类的相关信息和类型信息**
- 通过字节码和`JVM`实现了跨平台

**对象创建过程:**

1. **`new` 一个新对象** 或者 **引用静态成员变量**
2. **`JVM`**的**类加载器**根据对应的**类名**加载`class`文件.
3. **`JVM`** 通过`class`文件获取到`Class`对象创建实例

总结:

- 不过创建多少个对象,在每一个`JVM`中只会存在一个Class对象.

  我的理解就是:Class对象是作为一个封装类,根据**对象中的方法** 获取 类中的信息

- Class是一种特殊的类,不同于class关键字

- Class对象只有私有构造函数,所以只能通过`JVM`创建和加载

- Class对象的主要作用就是: 运行时 提供或获取 某个对象的类型信息.

#### 3.1.2 Class对象加载

- Class对象通过`JVM`加载.所有类都是在**第一次**使用的时候 **动态加载**到`JVM`中

  也就是说当一个类被调用的时候,就会加载这个类对应的字节码文件.

- 加载类文件是**按需加载**
- 文件加载时,需要接受相关验证,确保文件没有被破坏

#### 3.1.3 Class类加载过程

![image-20211002164858613](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211002164858613.png)

类加载过程:

- 加载: 通过**类名**获取该类的**字节码文件**,利用`JVM`加载到内存中.
- 链接: 验证字节码的安全和完整,为静态域**分配存储空间**.
  - 验证: 验证字节码文件的安全和完整性
  - 准备: 为静态域分配存储位置和空间
  - 解析: 通过Class对象获取类的信息
- 初始化: 类加载的最后阶段,如果该类有超类,运行静态初始化器对静态的属性进行初始化.

**类加载的初始化规定:**

- `JVM`启动时,用户需要指定一个需要执行的主类,虚拟机会先初始化这个类.
- 使用`new` 实例化对象 | 读取 | 设置一个类的静态字段或者调用静态方法,**必须触发类的初始化.**
- 存在父类的子类,初始化子类会先初始化父类.
- 使用反射方法获取反射类方法的时候,需要初始化

## 4.反射的具体使用

4.1 